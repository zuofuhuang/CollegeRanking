<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Becoming a proud Bayesian | MATH 454 Bayesian Statistics - College Ranking</title>
  <meta name="description" content="Chapter 9 Becoming a proud Bayesian | MATH 454 Bayesian Statistics - College Ranking" />
  <meta name="generator" content="bookdown  and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Becoming a proud Bayesian | MATH 454 Bayesian Statistics - College Ranking" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="zuofuhuang/CollegeRanking" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Becoming a proud Bayesian | MATH 454 Bayesian Statistics - College Ranking" />
  
  
  

<meta name="author" content="Zuofu Huang and Kavya Shetty, Spring 2019 Macalester College" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="bayesian-models-part-2.html">
<link rel="next" href="a-little-shiny.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="motivation.html"><a href="motivation.html"><i class="fa fa-check"></i><b>2</b> Motivation</a><ul>
<li class="chapter" data-level="2.1" data-path="motivation.html"><a href="motivation.html#why-this"><i class="fa fa-check"></i><b>2.1</b> Why this?</a></li>
<li class="chapter" data-level="2.2" data-path="motivation.html"><a href="motivation.html#a-snapshot"><i class="fa fa-check"></i><b>2.2</b> A snapshot</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-source.html"><a href="data-source.html"><i class="fa fa-check"></i><b>3</b> Data source</a><ul>
<li class="chapter" data-level="3.1" data-path="data-source.html"><a href="data-source.html#data-that-makes-our-work-possible"><i class="fa fa-check"></i><b>3.1</b> Data that makes our work possible</a></li>
<li class="chapter" data-level="3.2" data-path="data-source.html"><a href="data-source.html#our-data-dictionary"><i class="fa fa-check"></i><b>3.2</b> Our data dictionary</a></li>
<li class="chapter" data-level="3.3" data-path="data-source.html"><a href="data-source.html#changes-to-datasets"><i class="fa fa-check"></i><b>3.3</b> Changes to datasets</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-cleaning.html"><a href="data-cleaning.html"><i class="fa fa-check"></i><b>4</b> Data cleaning</a><ul>
<li class="chapter" data-level="4.1" data-path="data-cleaning.html"><a href="data-cleaning.html#what-did-we-do"><i class="fa fa-check"></i><b>4.1</b> What <strong>did</strong> we do?</a><ul>
<li class="chapter" data-level="4.1.1" data-path="data-cleaning.html"><a href="data-cleaning.html#load-data-select-and-rename-columns"><i class="fa fa-check"></i><b>4.1.1</b> Load data, select and rename columns</a></li>
<li class="chapter" data-level="4.1.2" data-path="data-cleaning.html"><a href="data-cleaning.html#filter-schools-that-have-a-rank"><i class="fa fa-check"></i><b>4.1.2</b> Filter schools that have a rank</a></li>
<li class="chapter" data-level="4.1.3" data-path="data-cleaning.html"><a href="data-cleaning.html#join-datasets"><i class="fa fa-check"></i><b>4.1.3</b> Join datasets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>5</b> Visualization</a><ul>
<li class="chapter" data-level="5.1" data-path="visualization.html"><a href="visualization.html#st-2nd-peeks"><i class="fa fa-check"></i><b>5.1</b> 1st &amp; 2nd Peeks</a></li>
<li class="chapter" data-level="5.2" data-path="visualization.html"><a href="visualization.html#rd-peek"><i class="fa fa-check"></i><b>5.2</b> 3rd Peek</a></li>
<li class="chapter" data-level="5.3" data-path="visualization.html"><a href="visualization.html#th-peek"><i class="fa fa-check"></i><b>5.3</b> 4th Peek</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="bayesian-models-part-1-1-university.html"><a href="bayesian-models-part-1-1-university.html"><i class="fa fa-check"></i><b>6</b> Bayesian Models Part 1.1 University</a><ul>
<li class="chapter" data-level="6.1" data-path="bayesian-models-part-1-1-university.html"><a href="bayesian-models-part-1-1-university.html#model-0"><i class="fa fa-check"></i><b>6.1</b> Model 0</a><ul>
<li class="chapter" data-level="6.1.1" data-path="bayesian-models-part-1-1-university.html"><a href="bayesian-models-part-1-1-university.html#first-impression"><i class="fa fa-check"></i><b>6.1.1</b> First Impression</a></li>
<li class="chapter" data-level="6.1.2" data-path="bayesian-models-part-1-1-university.html"><a href="bayesian-models-part-1-1-university.html#building-the-model"><i class="fa fa-check"></i><b>6.1.2</b> Building the model</a></li>
<li class="chapter" data-level="6.1.3" data-path="bayesian-models-part-1-1-university.html"><a href="bayesian-models-part-1-1-university.html#model-summary"><i class="fa fa-check"></i><b>6.1.3</b> Model summary</a></li>
<li class="chapter" data-level="6.1.4" data-path="bayesian-models-part-1-1-university.html"><a href="bayesian-models-part-1-1-university.html#posterior-inference"><i class="fa fa-check"></i><b>6.1.4</b> Posterior inference</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="bayesian-models-part-1-1-university.html"><a href="bayesian-models-part-1-1-university.html#model-1"><i class="fa fa-check"></i><b>6.2</b> Model 1</a><ul>
<li class="chapter" data-level="6.2.1" data-path="bayesian-models-part-1-1-university.html"><a href="bayesian-models-part-1-1-university.html#first-impression-1"><i class="fa fa-check"></i><b>6.2.1</b> First Impression</a></li>
<li class="chapter" data-level="6.2.2" data-path="bayesian-models-part-1-1-university.html"><a href="bayesian-models-part-1-1-university.html#building-the-model-1"><i class="fa fa-check"></i><b>6.2.2</b> Building the model</a></li>
<li class="chapter" data-level="6.2.3" data-path="bayesian-models-part-1-1-university.html"><a href="bayesian-models-part-1-1-university.html#model-summary-1"><i class="fa fa-check"></i><b>6.2.3</b> Model summary</a></li>
<li class="chapter" data-level="6.2.4" data-path="bayesian-models-part-1-1-university.html"><a href="bayesian-models-part-1-1-university.html#posterior-inference-1"><i class="fa fa-check"></i><b>6.2.4</b> Posterior inference</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="bayesian-models-part-1-1-university.html"><a href="bayesian-models-part-1-1-university.html#model-2"><i class="fa fa-check"></i><b>6.3</b> Model 2</a><ul>
<li class="chapter" data-level="6.3.1" data-path="bayesian-models-part-1-1-university.html"><a href="bayesian-models-part-1-1-university.html#first-impression-2"><i class="fa fa-check"></i><b>6.3.1</b> First Impression</a></li>
<li class="chapter" data-level="6.3.2" data-path="bayesian-models-part-1-1-university.html"><a href="bayesian-models-part-1-1-university.html#building-the-model-2"><i class="fa fa-check"></i><b>6.3.2</b> Building the model</a></li>
<li class="chapter" data-level="6.3.3" data-path="bayesian-models-part-1-1-university.html"><a href="bayesian-models-part-1-1-university.html#model-summary-2"><i class="fa fa-check"></i><b>6.3.3</b> Model summary</a></li>
<li class="chapter" data-level="6.3.4" data-path="bayesian-models-part-1-1-university.html"><a href="bayesian-models-part-1-1-university.html#posterior-inference-2"><i class="fa fa-check"></i><b>6.3.4</b> Posterior inference</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="bayesian-models-part-1-1-university.html"><a href="bayesian-models-part-1-1-university.html#future-steps"><i class="fa fa-check"></i><b>6.4</b> Future steps</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="bayesian-models-part-1-2-liberal-arts.html"><a href="bayesian-models-part-1-2-liberal-arts.html"><i class="fa fa-check"></i><b>7</b> Bayesian Models Part 1.2 Liberal Arts</a><ul>
<li class="chapter" data-level="7.1" data-path="bayesian-models-part-1-2-liberal-arts.html"><a href="bayesian-models-part-1-2-liberal-arts.html#model-0-1"><i class="fa fa-check"></i><b>7.1</b> Model 0</a><ul>
<li class="chapter" data-level="7.1.1" data-path="bayesian-models-part-1-2-liberal-arts.html"><a href="bayesian-models-part-1-2-liberal-arts.html#first-impression-3"><i class="fa fa-check"></i><b>7.1.1</b> First Impression</a></li>
<li class="chapter" data-level="7.1.2" data-path="bayesian-models-part-1-2-liberal-arts.html"><a href="bayesian-models-part-1-2-liberal-arts.html#building-the-model-3"><i class="fa fa-check"></i><b>7.1.2</b> Building the model</a></li>
<li class="chapter" data-level="7.1.3" data-path="bayesian-models-part-1-2-liberal-arts.html"><a href="bayesian-models-part-1-2-liberal-arts.html#model-summary-3"><i class="fa fa-check"></i><b>7.1.3</b> Model summary</a></li>
<li class="chapter" data-level="7.1.4" data-path="bayesian-models-part-1-2-liberal-arts.html"><a href="bayesian-models-part-1-2-liberal-arts.html#posterior-inference-3"><i class="fa fa-check"></i><b>7.1.4</b> Posterior inference</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="bayesian-models-part-1-2-liberal-arts.html"><a href="bayesian-models-part-1-2-liberal-arts.html#model-1-1"><i class="fa fa-check"></i><b>7.2</b> Model 1</a></li>
<li class="chapter" data-level="7.3" data-path="bayesian-models-part-1-2-liberal-arts.html"><a href="bayesian-models-part-1-2-liberal-arts.html#model-2-1"><i class="fa fa-check"></i><b>7.3</b> Model 2</a><ul>
<li class="chapter" data-level="7.3.1" data-path="bayesian-models-part-1-2-liberal-arts.html"><a href="bayesian-models-part-1-2-liberal-arts.html#first-impression-4"><i class="fa fa-check"></i><b>7.3.1</b> First Impression</a></li>
<li class="chapter" data-level="7.3.2" data-path="bayesian-models-part-1-2-liberal-arts.html"><a href="bayesian-models-part-1-2-liberal-arts.html#building-the-model-4"><i class="fa fa-check"></i><b>7.3.2</b> Building the model</a></li>
<li class="chapter" data-level="7.3.3" data-path="bayesian-models-part-1-2-liberal-arts.html"><a href="bayesian-models-part-1-2-liberal-arts.html#model-summary-4"><i class="fa fa-check"></i><b>7.3.3</b> Model summary</a></li>
<li class="chapter" data-level="7.3.4" data-path="bayesian-models-part-1-2-liberal-arts.html"><a href="bayesian-models-part-1-2-liberal-arts.html#posterior-inference-4"><i class="fa fa-check"></i><b>7.3.4</b> Posterior inference</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="bayesian-models-part-1-2-liberal-arts.html"><a href="bayesian-models-part-1-2-liberal-arts.html#future-steps-1"><i class="fa fa-check"></i><b>7.4</b> Future steps</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="bayesian-models-part-2.html"><a href="bayesian-models-part-2.html"><i class="fa fa-check"></i><b>8</b> Bayesian Models Part 2</a><ul>
<li class="chapter" data-level="8.1" data-path="bayesian-models-part-2.html"><a href="bayesian-models-part-2.html#possible-data-cleaning"><i class="fa fa-check"></i><b>8.1</b> Possible data cleaning?</a></li>
<li class="chapter" data-level="8.2" data-path="bayesian-models-part-2.html"><a href="bayesian-models-part-2.html#on-the-way-to-final-model"><i class="fa fa-check"></i><b>8.2</b> On the way to Final Model</a></li>
<li class="chapter" data-level="8.3" data-path="bayesian-models-part-2.html"><a href="bayesian-models-part-2.html#what-are-we-thinking"><i class="fa fa-check"></i><b>8.3</b> What are we thinking?</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="becoming-a-proud-bayesian.html"><a href="becoming-a-proud-bayesian.html"><i class="fa fa-check"></i><b>9</b> Becoming a proud Bayesian</a><ul>
<li class="chapter" data-level="9.1" data-path="becoming-a-proud-bayesian.html"><a href="becoming-a-proud-bayesian.html#university-model"><i class="fa fa-check"></i><b>9.1</b> University Model</a><ul>
<li class="chapter" data-level="9.1.1" data-path="becoming-a-proud-bayesian.html"><a href="becoming-a-proud-bayesian.html#get-some-intuition"><i class="fa fa-check"></i><b>9.1.1</b> Get some intuition</a></li>
<li class="chapter" data-level="9.1.2" data-path="becoming-a-proud-bayesian.html"><a href="becoming-a-proud-bayesian.html#some-additional-intuition"><i class="fa fa-check"></i><b>9.1.2</b> Some additional intuition</a></li>
<li class="chapter" data-level="9.1.3" data-path="becoming-a-proud-bayesian.html"><a href="becoming-a-proud-bayesian.html#building-the-model-5"><i class="fa fa-check"></i><b>9.1.3</b> Building the model</a></li>
<li class="chapter" data-level="9.1.4" data-path="becoming-a-proud-bayesian.html"><a href="becoming-a-proud-bayesian.html#model-summary-5"><i class="fa fa-check"></i><b>9.1.4</b> Model summary</a></li>
<li class="chapter" data-level="9.1.5" data-path="becoming-a-proud-bayesian.html"><a href="becoming-a-proud-bayesian.html#posterior-inference-5"><i class="fa fa-check"></i><b>9.1.5</b> Posterior inference</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="becoming-a-proud-bayesian.html"><a href="becoming-a-proud-bayesian.html#liberal-arts-colleges"><i class="fa fa-check"></i><b>9.2</b> Liberal Arts Colleges</a><ul>
<li class="chapter" data-level="9.2.1" data-path="becoming-a-proud-bayesian.html"><a href="becoming-a-proud-bayesian.html#get-some-intuition-1"><i class="fa fa-check"></i><b>9.2.1</b> Get some intuition</a></li>
<li class="chapter" data-level="9.2.2" data-path="becoming-a-proud-bayesian.html"><a href="becoming-a-proud-bayesian.html#building-the-model-6"><i class="fa fa-check"></i><b>9.2.2</b> Building the model</a></li>
<li class="chapter" data-level="9.2.3" data-path="becoming-a-proud-bayesian.html"><a href="becoming-a-proud-bayesian.html#model-summary-6"><i class="fa fa-check"></i><b>9.2.3</b> Model summary</a></li>
<li class="chapter" data-level="9.2.4" data-path="becoming-a-proud-bayesian.html"><a href="becoming-a-proud-bayesian.html#posterior-inference-6"><i class="fa fa-check"></i><b>9.2.4</b> Posterior inference</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="becoming-a-proud-bayesian.html"><a href="becoming-a-proud-bayesian.html#comparison-and-discussion"><i class="fa fa-check"></i><b>9.3</b> Comparison and discussion</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="a-little-shiny.html"><a href="a-little-shiny.html"><i class="fa fa-check"></i><b>10</b> A Little Shiny</a><ul>
<li class="chapter" data-level="10.1" data-path="a-little-shiny.html"><a href="a-little-shiny.html#shiny-app"><i class="fa fa-check"></i><b>10.1</b> Shiny App</a></li>
<li class="chapter" data-level="10.2" data-path="a-little-shiny.html"><a href="a-little-shiny.html#in-case-youre-curious"><i class="fa fa-check"></i><b>10.2</b> In case you’re curious</a><ul>
<li class="chapter" data-level="10.2.1" data-path="a-little-shiny.html"><a href="a-little-shiny.html#code-for-shiny-app-collegeranking"><i class="fa fa-check"></i><b>10.2.1</b> Code for Shiny App “collegeranking”</a></li>
<li class="chapter" data-level="10.2.2" data-path="a-little-shiny.html"><a href="a-little-shiny.html#code-for-shiny-app-universityranking"><i class="fa fa-check"></i><b>10.2.2</b> Code for Shiny App “UniversityRanking”</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MATH 454 Bayesian Statistics - College Ranking</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="becoming-a-proud-bayesian" class="section level1">
<h1><span class="header-section-number">Chapter 9</span> Becoming a proud Bayesian</h1>
<p>For our finalized Bayesian model, we intend to build predictive models for universities and liberal arts colleges. Then we’ll compare the similarities and differences of the two models. (i.e. is some factor important for universities and less so for liberal arts colleges?)</p>
<div id="university-model" class="section level2">
<h2><span class="header-section-number">9.1</span> University Model</h2>
<div id="get-some-intuition" class="section level3">
<h3><span class="header-section-number">9.1.1</span> Get some intuition</h3>
<p>We could build bi-variate visualizations that help us understand the individual trends:</p>
<p><img src="CollegeRanking_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
</div>
<div id="some-additional-intuition" class="section level3">
<h3><span class="header-section-number">9.1.2</span> Some additional intuition</h3>
<p>For more intuition, we start with more vague priors and slightly adjust the priors based on the summary table. It’s important to note that the priors cannot be set too close to the means of the summary table in case of <strong>overfitting</strong>.</p>
</div>
<div id="building-the-model-5" class="section level3">
<h3><span class="header-section-number">9.1.3</span> Building the model</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">university_model_<span class="dv">3</span> &lt;-<span class="st"> &quot;model{  </span>
<span class="st">    # Data: observations</span>
<span class="st">    for(i in 1:length(y)) {</span>
<span class="st">        y[i] ~ dpois(lambda[i])</span>
<span class="st">        log(lambda[i]) = beta0 + beta1*x1[i] + beta2[z[i]] + beta3*x3[i] + beta4*x4[i]</span>
<span class="st">    }</span>
<span class="st">        # Data: subjects</span>
<span class="st">        beta0 ~ dnorm(8, 1)</span>
<span class="st">        beta1 ~ dnorm(0, 10000)</span>
<span class="st">        beta2[1] &lt;- 0 </span>
<span class="st">        beta2[2] ~ dnorm(0, 0.01)</span>
<span class="st">        beta2[3] ~ dnorm(0, 0.01)</span>
<span class="st">        beta3 ~ dnorm(0, 10)</span>
<span class="st">        beta4 ~ dnorm(0, 0.01)</span>

<span class="st">}&quot;</span>

<span class="co"># COMPILE</span>

y &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(fullUniversity<span class="op">$</span>Y2018)

model_data9 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(y, <span class="dt">x1 =</span> fullUniversity<span class="op">$</span>UGDS_<span class="dv">1617</span>, <span class="dt">z =</span> <span class="kw">as.numeric</span>(fullUniversity<span class="op">$</span>LOCALE_collapse), <span class="dt">x3 =</span> fullUniversity<span class="op">$</span>SAT_AVG_<span class="dv">1617</span>, <span class="dt">x4 =</span> fullUniversity<span class="op">$</span>ADM_RATE_<span class="dv">1617</span>)

model_data9 &lt;-<span class="st"> </span><span class="kw">na.omit</span>(model_data9)

university_jags_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">jags.model</span>(<span class="kw">textConnection</span>(university_model_<span class="dv">3</span>), 
    <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">y =</span> model_data9<span class="op">$</span>y, <span class="dt">x1 =</span> model_data9<span class="op">$</span>x1, <span class="dt">z =</span> <span class="kw">factor</span>(model_data9<span class="op">$</span>z), <span class="dt">x3 =</span> model_data9<span class="op">$</span>x3, <span class="dt">x4 =</span> model_data9<span class="op">$</span>x4),
    <span class="dt">inits=</span><span class="kw">list</span>(<span class="dt">.RNG.name =</span> <span class="st">&quot;base::Wichmann-Hill&quot;</span>, <span class="dt">.RNG.seed =</span> <span class="dv">454</span>))</code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 114
##    Unobserved stochastic nodes: 6
##    Total graph size: 1137
## 
## Initializing model</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># SIMULATE the model</span>
university_sim_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">coda.samples</span>(university_jags_<span class="dv">3</span>,
    <span class="dt">variable.names =</span> <span class="kw">c</span>(<span class="st">&quot;beta0&quot;</span>,<span class="st">&quot;beta1&quot;</span>,<span class="st">&quot;beta2&quot;</span>,<span class="st">&quot;beta3&quot;</span>,<span class="st">&quot;beta4&quot;</span>),
    <span class="dt">n.iter =</span> <span class="dv">10000</span>)

<span class="co"># STORE the chains in a data frame</span>
university_chains_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">data.frame</span>(university_sim_<span class="dv">3</span>[[<span class="dv">1</span>]])</code></pre></div>
</div>
<div id="model-summary-5" class="section level3">
<h3><span class="header-section-number">9.1.4</span> Model summary</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(university_sim_<span class="dv">3</span>)</code></pre></div>
<pre><code>## 
## Iterations = 1001:11000
## Thinning interval = 1 
## Number of chains = 1 
## Sample size per chain = 10000 
## 
## 1. Empirical mean and standard deviation for each variable,
##    plus standard error of the mean:
## 
##                Mean        SD  Naive SE Time-series SE
## beta0     6.693e+00 3.148e-01 3.148e-03      1.064e-01
## beta1    -4.418e-06 1.154e-06 1.154e-08      3.881e-08
## beta2[1]  0.000e+00 0.000e+00 0.000e+00      0.000e+00
## beta2[2]  1.529e-02 3.080e-02 3.080e-04      6.158e-04
## beta2[3]  1.464e-01 5.940e-02 5.940e-04      1.345e-03
## beta3    -2.539e-03 2.136e-04 2.136e-06      6.886e-05
## beta4     1.374e+00 1.055e-01 1.055e-03      1.990e-02
## 
## 2. Quantiles for each variable:
## 
##                2.5%        25%        50%        75%      97.5%
## beta0     6.1899756  6.474e+00  6.6367448  6.853e+00  7.416e+00
## beta1    -0.0000067 -5.213e-06 -0.0000044 -3.621e-06 -2.184e-06
## beta2[1]  0.0000000  0.000e+00  0.0000000  0.000e+00  0.000e+00
## beta2[2] -0.0454972 -5.617e-03  0.0151296  3.629e-02  7.586e-02
## beta2[3]  0.0265393  1.076e-01  0.1474028  1.870e-01  2.622e-01
## beta3    -0.0030334 -2.650e-03 -0.0025023 -2.393e-03 -2.194e-03
## beta4     1.1282817  1.311e+00  1.3846333  1.447e+00  1.551e+00</code></pre>
</div>
<div id="posterior-inference-5" class="section level3">
<h3><span class="header-section-number">9.1.5</span> Posterior inference</h3>
<p>For an unknown university located in the city with 10000 undergraduates, student mean SAT score of 1400 and an admission rate of <span class="math inline">\(25\%\)</span> (e.g. Gvictor University), we could predict its ranking from our rjags simulation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">university_chains_<span class="dv">3</span> &lt;-<span class="st"> </span>university_chains_<span class="dv">3</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ranking_new =</span> <span class="kw">rpois</span>(<span class="dv">10000</span>, <span class="dt">lambda =</span> <span class="kw">exp</span>(beta0 <span class="op">+</span><span class="st"> </span>beta1 <span class="op">*</span><span class="st"> </span><span class="dv">10000</span> <span class="op">+</span><span class="st"> </span>beta3 <span class="op">*</span><span class="st"> </span><span class="dv">1400</span> <span class="op">+</span><span class="st"> </span>beta4 <span class="op">*</span><span class="st"> </span><span class="fl">0.25</span>)))

university_chains_<span class="dv">3</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="kw">quantile</span>(ranking_new,<span class="fl">0.025</span>),<span class="kw">quantile</span>(ranking_new,<span class="fl">0.975</span>))</code></pre></div>
<pre><code>##   quantile(ranking_new, 0.025) quantile(ranking_new, 0.975)
## 1                           21                           43</code></pre>
<p>The interval is more reflective of the intuitive estimate of Gvictor University’s ranking.</p>
</div>
</div>
<div id="liberal-arts-colleges" class="section level2">
<h2><span class="header-section-number">9.2</span> Liberal Arts Colleges</h2>
<div id="get-some-intuition-1" class="section level3">
<h3><span class="header-section-number">9.2.1</span> Get some intuition</h3>
<p>Similar to what we do with universities, we could build bi-variate visualizations that help us understand the individual trends:</p>
<p><img src="CollegeRanking_files/figure-html/unnamed-chunk-64-1.png" width="672" /></p>
</div>
<div id="building-the-model-6" class="section level3">
<h3><span class="header-section-number">9.2.2</span> Building the model</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">liberal_model_<span class="dv">3</span> &lt;-<span class="st"> &quot;model{  </span>
<span class="st">    # Data: observations</span>
<span class="st">    for(i in 1:length(y)) {</span>
<span class="st">        y[i] ~ dpois(lambda[i])</span>
<span class="st">        log(lambda[i]) = beta0 + beta1*x1[i] + beta2[z[i]] + beta3*x3[i] + beta4*x4[i]</span>
<span class="st">    }</span>
<span class="st">    # Data: subjects</span>
<span class="st">    beta0 ~ dnorm(0, 0.0001)</span>
<span class="st">    beta1 ~ dnorm(0, 10000)</span>
<span class="st">    beta2[1] &lt;- 0 </span>
<span class="st">    beta2[2] ~ dnorm(0, 0.04)</span>
<span class="st">    beta2[3] ~ dnorm(-10, 0.04)</span>
<span class="st">    beta2[4] ~ dnorm(-15, 0.01)</span>
<span class="st">    beta3 ~ dnorm(-0.3, 100)</span>
<span class="st">    beta4 ~ dnorm(36, 10)</span>

<span class="st">}&quot;</span>

<span class="co"># COMPILE</span>

y &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(full_LiberalArts<span class="op">$</span>Y2018)

model_data8 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(y, <span class="dt">x1 =</span> <span class="kw">as.numeric</span>(full_LiberalArts<span class="op">$</span>UGDS_<span class="dv">1617</span>), <span class="dt">z =</span> <span class="kw">as.numeric</span>(full_LiberalArts<span class="op">$</span>LOCALE_collapse_lac1), <span class="dt">x3 =</span> <span class="kw">as.numeric</span>(full_LiberalArts<span class="op">$</span>SAT_AVG_<span class="dv">1617</span>), <span class="dt">x4 =</span> <span class="kw">as.numeric</span>(full_LiberalArts<span class="op">$</span>ADM_RATE_<span class="dv">1617</span>))

model_data8 &lt;-<span class="st"> </span><span class="kw">na.omit</span>(model_data8)

liberal_jags_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">jags.model</span>(<span class="kw">textConnection</span>(liberal_model_<span class="dv">3</span>), 
    <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">y =</span> model_data8<span class="op">$</span>y, <span class="dt">x1 =</span> model_data8<span class="op">$</span>x1, <span class="dt">z =</span> <span class="kw">factor</span>(model_data8<span class="op">$</span>z), <span class="dt">x3 =</span> model_data8<span class="op">$</span>x3, <span class="dt">x4 =</span> model_data8<span class="op">$</span>x4),
    <span class="dt">inits=</span><span class="kw">list</span>(<span class="dt">.RNG.name =</span> <span class="st">&quot;base::Wichmann-Hill&quot;</span>, <span class="dt">.RNG.seed =</span> <span class="dv">454</span>))</code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 101
##    Unobserved stochastic nodes: 7
##    Total graph size: 1014
## 
## Initializing model</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># SIMULATE the model</span>
liberal_sim_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">coda.samples</span>(liberal_jags_<span class="dv">3</span>,
    <span class="dt">variable.names =</span> <span class="kw">c</span>(<span class="st">&quot;beta0&quot;</span>,<span class="st">&quot;beta1&quot;</span>,<span class="st">&quot;beta2&quot;</span>,<span class="st">&quot;beta3&quot;</span>,<span class="st">&quot;beta4&quot;</span>),
    <span class="dt">n.iter =</span> <span class="dv">10000</span>)

<span class="co"># STORE the chains in a data frame</span>
liberal_chains_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">data.frame</span>(liberal_sim_<span class="dv">3</span>[[<span class="dv">1</span>]])</code></pre></div>
</div>
<div id="model-summary-6" class="section level3">
<h3><span class="header-section-number">9.2.3</span> Model summary</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(liberal_sim_<span class="dv">3</span>)</code></pre></div>
<pre><code>## 
## Iterations = 1001:11000
## Thinning interval = 1 
## Number of chains = 1 
## Sample size per chain = 10000 
## 
## 1. Empirical mean and standard deviation for each variable,
##    plus standard error of the mean:
## 
##                Mean        SD  Naive SE Time-series SE
## beta0     5.7575868 3.6590045 3.659e-02      9.521e-01
## beta1    -0.0001047 0.0001043 1.043e-06      2.494e-05
## beta2[1]  0.0000000 0.0000000 0.000e+00      0.000e+00
## beta2[2] -0.1862067 0.1544641 1.545e-03      3.231e-02
## beta2[3] -0.1221312 0.0503896 5.039e-04      6.979e-03
## beta2[4] -0.5671952 0.2174377 2.174e-03      4.696e-02
## beta3    -0.0024861 0.0028859 2.886e-05      7.252e-04
## beta4     2.9260686 1.0288947 1.029e-02      2.916e-01
## 
## 2. Quantiles for each variable:
## 
##                2.5%        25%        50%        75%      97.5%
## beta0     4.5244176  4.7629993  4.8721236  5.0651715 18.1141821
## beta1    -0.0001654 -0.0001408 -0.0001265 -0.0001113  0.0002968
## beta2[1]  0.0000000  0.0000000  0.0000000  0.0000000  0.0000000
## beta2[2] -0.2737200 -0.2348096 -0.2141429 -0.1912261  0.2485554
## beta2[3] -0.1984605 -0.1453506 -0.1246138 -0.1044559 -0.0508085
## beta2[4] -0.7104135 -0.6439770 -0.6077693 -0.5682324  0.1487860
## beta3    -0.0119698 -0.0019412 -0.0018121 -0.0017256 -0.0015404
## beta4    -0.9364295  3.1050759  3.1747504  3.2368810  3.3537106</code></pre>
</div>
<div id="posterior-inference-6" class="section level3">
<h3><span class="header-section-number">9.2.4</span> Posterior inference</h3>
<p>For an unknown liberal arts college in a rural setting with 2000 undergraduates, student mean SAT score of 1400 and an admission rate of <span class="math inline">\(25\%\)</span> (e.g. Hvictor College), we could predict its ranking from our rjags simulation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">liberal_chains_<span class="dv">3</span> &lt;-<span class="st"> </span>liberal_chains_<span class="dv">3</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ranking_new =</span> <span class="kw">rpois</span>(<span class="dv">10000</span>, <span class="kw">exp</span>(beta0 <span class="op">+</span><span class="st"> </span>beta1 <span class="op">*</span><span class="st"> </span><span class="dv">2000</span> <span class="op">+</span><span class="st"> </span>beta2.<span class="dv">4</span>. <span class="op">+</span><span class="st"> </span>beta3 <span class="op">*</span><span class="st"> </span><span class="dv">1400</span> <span class="op">+</span><span class="st"> </span>beta4 <span class="op">*</span><span class="st"> </span><span class="fl">0.25</span>)))

liberal_chains_<span class="dv">3</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="kw">quantile</span>(ranking_new,<span class="fl">0.025</span>),<span class="kw">quantile</span>(ranking_new,<span class="fl">0.975</span>))</code></pre></div>
<pre><code>##   quantile(ranking_new, 0.025) quantile(ranking_new, 0.975)
## 1                            3                           16</code></pre>
<p>This is <strong>totally reasonable</strong>! The interval roughly reflects the intuitive estimate of Hvictor College’s ranking.</p>
</div>
</div>
<div id="comparison-and-discussion" class="section level2">
<h2><span class="header-section-number">9.3</span> Comparison and discussion</h2>
<p>Compared to the last attempts, our final model gives reasonable predictions, which is a huge progress! However, the 95% credible interval it provides doesn’t provide an accurate enough interval as desired.</p>
<p>By creating different imaginery universities and colleges, we are able to summarize the most important factors for universities and colleges respectively. We find that universities value SAT score as a more decisive indicator of both students’ admission and their own ranking.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="bayesian-models-part-2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="a-little-shiny.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
