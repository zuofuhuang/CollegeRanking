<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Bayesian Models 1.1 Universities | MATH 454 Bayesian Statistics - College Ranking</title>
  <meta name="description" content="Chapter 6 Bayesian Models 1.1 Universities | MATH 454 Bayesian Statistics - College Ranking" />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Bayesian Models 1.1 Universities | MATH 454 Bayesian Statistics - College Ranking" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="zuofuhuang/CollegeRanking" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Bayesian Models 1.1 Universities | MATH 454 Bayesian Statistics - College Ranking" />
  
  
  

<meta name="author" content="Zuofu Huang and Kavya Shetty, Spring 2019 Macalester College" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="visualizations.html"/>
<link rel="next" href="bayesian-models-1-2-lacs.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="motivation.html"><a href="motivation.html"><i class="fa fa-check"></i><b>2</b> Motivation</a><ul>
<li class="chapter" data-level="2.1" data-path="motivation.html"><a href="motivation.html#why-this"><i class="fa fa-check"></i><b>2.1</b> Why this?</a></li>
<li class="chapter" data-level="2.2" data-path="motivation.html"><a href="motivation.html#a-snapshot"><i class="fa fa-check"></i><b>2.2</b> A snapshot</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-source.html"><a href="data-source.html"><i class="fa fa-check"></i><b>3</b> Data source</a><ul>
<li class="chapter" data-level="3.1" data-path="data-source.html"><a href="data-source.html#data-that-makes-our-work-possible"><i class="fa fa-check"></i><b>3.1</b> Data that makes our work possible</a></li>
<li class="chapter" data-level="3.2" data-path="data-source.html"><a href="data-source.html#our-data-dictionary"><i class="fa fa-check"></i><b>3.2</b> Our data dictionary</a></li>
<li class="chapter" data-level="3.3" data-path="data-source.html"><a href="data-source.html#changes-to-datasets"><i class="fa fa-check"></i><b>3.3</b> Changes to datasets</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-cleaning.html"><a href="data-cleaning.html"><i class="fa fa-check"></i><b>4</b> Data cleaning</a><ul>
<li class="chapter" data-level="4.1" data-path="data-cleaning.html"><a href="data-cleaning.html#what-did-we-do"><i class="fa fa-check"></i><b>4.1</b> What <strong>did</strong> we do?</a><ul>
<li class="chapter" data-level="4.1.1" data-path="data-cleaning.html"><a href="data-cleaning.html#load-data-select-and-rename-columns"><i class="fa fa-check"></i><b>4.1.1</b> Load data, select and rename columns</a></li>
<li class="chapter" data-level="4.1.2" data-path="data-cleaning.html"><a href="data-cleaning.html#filter-schools-that-have-a-rank"><i class="fa fa-check"></i><b>4.1.2</b> Filter schools that have a rank</a></li>
<li class="chapter" data-level="4.1.3" data-path="data-cleaning.html"><a href="data-cleaning.html#join-datasets"><i class="fa fa-check"></i><b>4.1.3</b> Join datasets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="visualizations.html"><a href="visualizations.html"><i class="fa fa-check"></i><b>5</b> Visualizations</a><ul>
<li class="chapter" data-level="5.1" data-path="visualizations.html"><a href="visualizations.html#st-2nd-peeks"><i class="fa fa-check"></i><b>5.1</b> 1st &amp; 2nd Peeks</a><ul>
<li class="chapter" data-level="5.1.1" data-path="visualizations.html"><a href="visualizations.html#visualization-1-region-setting"><i class="fa fa-check"></i><b>5.1.1</b> Visualization 1: Region &amp; Setting</a></li>
<li class="chapter" data-level="5.1.2" data-path="visualizations.html"><a href="visualizations.html#visualization-2-general-locale-breakdown"><i class="fa fa-check"></i><b>5.1.2</b> Visualization 2: General Locale &amp; Breakdown</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="visualizations.html"><a href="visualizations.html#rd-peek"><i class="fa fa-check"></i><b>5.2</b> 3rd Peek</a></li>
<li class="chapter" data-level="5.3" data-path="visualizations.html"><a href="visualizations.html#th-peek"><i class="fa fa-check"></i><b>5.3</b> 4th Peek</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="bayesian-models-1-1-universities.html"><a href="bayesian-models-1-1-universities.html"><i class="fa fa-check"></i><b>6</b> Bayesian Models 1.1 Universities</a><ul>
<li class="chapter" data-level="6.1" data-path="bayesian-models-1-1-universities.html"><a href="bayesian-models-1-1-universities.html#model-0"><i class="fa fa-check"></i><b>6.1</b> Model 0</a><ul>
<li class="chapter" data-level="6.1.1" data-path="bayesian-models-1-1-universities.html"><a href="bayesian-models-1-1-universities.html#first-impression"><i class="fa fa-check"></i><b>6.1.1</b> First Impression</a></li>
<li class="chapter" data-level="6.1.2" data-path="bayesian-models-1-1-universities.html"><a href="bayesian-models-1-1-universities.html#building-the-model"><i class="fa fa-check"></i><b>6.1.2</b> Building the model</a></li>
<li class="chapter" data-level="6.1.3" data-path="bayesian-models-1-1-universities.html"><a href="bayesian-models-1-1-universities.html#model-summary"><i class="fa fa-check"></i><b>6.1.3</b> Model summary</a></li>
<li class="chapter" data-level="6.1.4" data-path="bayesian-models-1-1-universities.html"><a href="bayesian-models-1-1-universities.html#posterior-inference"><i class="fa fa-check"></i><b>6.1.4</b> Posterior inference</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="bayesian-models-1-1-universities.html"><a href="bayesian-models-1-1-universities.html#model-1"><i class="fa fa-check"></i><b>6.2</b> Model 1</a><ul>
<li class="chapter" data-level="6.2.1" data-path="bayesian-models-1-1-universities.html"><a href="bayesian-models-1-1-universities.html#first-impression-1"><i class="fa fa-check"></i><b>6.2.1</b> First Impression</a></li>
<li class="chapter" data-level="6.2.2" data-path="bayesian-models-1-1-universities.html"><a href="bayesian-models-1-1-universities.html#building-the-model-1"><i class="fa fa-check"></i><b>6.2.2</b> Building the model</a></li>
<li class="chapter" data-level="6.2.3" data-path="bayesian-models-1-1-universities.html"><a href="bayesian-models-1-1-universities.html#model-summary-1"><i class="fa fa-check"></i><b>6.2.3</b> Model summary</a></li>
<li class="chapter" data-level="6.2.4" data-path="bayesian-models-1-1-universities.html"><a href="bayesian-models-1-1-universities.html#posterior-inference-1"><i class="fa fa-check"></i><b>6.2.4</b> Posterior inference</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="bayesian-models-1-1-universities.html"><a href="bayesian-models-1-1-universities.html#model-2"><i class="fa fa-check"></i><b>6.3</b> Model 2</a><ul>
<li class="chapter" data-level="6.3.1" data-path="bayesian-models-1-1-universities.html"><a href="bayesian-models-1-1-universities.html#first-impression-2"><i class="fa fa-check"></i><b>6.3.1</b> First Impression</a></li>
<li class="chapter" data-level="6.3.2" data-path="bayesian-models-1-1-universities.html"><a href="bayesian-models-1-1-universities.html#building-the-model-2"><i class="fa fa-check"></i><b>6.3.2</b> Building the model</a></li>
<li class="chapter" data-level="6.3.3" data-path="bayesian-models-1-1-universities.html"><a href="bayesian-models-1-1-universities.html#model-summary-2"><i class="fa fa-check"></i><b>6.3.3</b> Model summary</a></li>
<li class="chapter" data-level="6.3.4" data-path="bayesian-models-1-1-universities.html"><a href="bayesian-models-1-1-universities.html#posterior-inference-2"><i class="fa fa-check"></i><b>6.3.4</b> Posterior inference</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="bayesian-models-1-1-universities.html"><a href="bayesian-models-1-1-universities.html#future-steps"><i class="fa fa-check"></i><b>6.4</b> Future steps</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="bayesian-models-1-2-lacs.html"><a href="bayesian-models-1-2-lacs.html"><i class="fa fa-check"></i><b>7</b> Bayesian Models 1.2 LACs</a><ul>
<li class="chapter" data-level="7.1" data-path="bayesian-models-1-2-lacs.html"><a href="bayesian-models-1-2-lacs.html#model-0-1"><i class="fa fa-check"></i><b>7.1</b> Model 0</a><ul>
<li class="chapter" data-level="7.1.1" data-path="bayesian-models-1-2-lacs.html"><a href="bayesian-models-1-2-lacs.html#first-impression-3"><i class="fa fa-check"></i><b>7.1.1</b> First Impression</a></li>
<li class="chapter" data-level="7.1.2" data-path="bayesian-models-1-2-lacs.html"><a href="bayesian-models-1-2-lacs.html#building-the-model-3"><i class="fa fa-check"></i><b>7.1.2</b> Building the model</a></li>
<li class="chapter" data-level="7.1.3" data-path="bayesian-models-1-2-lacs.html"><a href="bayesian-models-1-2-lacs.html#model-summary-3"><i class="fa fa-check"></i><b>7.1.3</b> Model summary</a></li>
<li class="chapter" data-level="7.1.4" data-path="bayesian-models-1-2-lacs.html"><a href="bayesian-models-1-2-lacs.html#posterior-inference-3"><i class="fa fa-check"></i><b>7.1.4</b> Posterior inference</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="bayesian-models-1-2-lacs.html"><a href="bayesian-models-1-2-lacs.html#model-1-1"><i class="fa fa-check"></i><b>7.2</b> Model 1</a></li>
<li class="chapter" data-level="7.3" data-path="bayesian-models-1-2-lacs.html"><a href="bayesian-models-1-2-lacs.html#model-2-1"><i class="fa fa-check"></i><b>7.3</b> Model 2</a><ul>
<li class="chapter" data-level="7.3.1" data-path="bayesian-models-1-2-lacs.html"><a href="bayesian-models-1-2-lacs.html#first-impression-4"><i class="fa fa-check"></i><b>7.3.1</b> First Impression</a></li>
<li class="chapter" data-level="7.3.2" data-path="bayesian-models-1-2-lacs.html"><a href="bayesian-models-1-2-lacs.html#building-the-model-4"><i class="fa fa-check"></i><b>7.3.2</b> Building the model</a></li>
<li class="chapter" data-level="7.3.3" data-path="bayesian-models-1-2-lacs.html"><a href="bayesian-models-1-2-lacs.html#model-summary-4"><i class="fa fa-check"></i><b>7.3.3</b> Model summary</a></li>
<li class="chapter" data-level="7.3.4" data-path="bayesian-models-1-2-lacs.html"><a href="bayesian-models-1-2-lacs.html#posterior-inference-4"><i class="fa fa-check"></i><b>7.3.4</b> Posterior inference</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="bayesian-models-1-2-lacs.html"><a href="bayesian-models-1-2-lacs.html#future-steps-1"><i class="fa fa-check"></i><b>7.4</b> Future steps</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="part-2-more-experimentation.html"><a href="part-2-more-experimentation.html"><i class="fa fa-check"></i><b>8</b> Part 2: More Experimentation</a><ul>
<li class="chapter" data-level="8.1" data-path="part-2-more-experimentation.html"><a href="part-2-more-experimentation.html#on-the-way-to-final-model"><i class="fa fa-check"></i><b>8.1</b> On the way to Final Model</a></li>
<li class="chapter" data-level="8.2" data-path="part-2-more-experimentation.html"><a href="part-2-more-experimentation.html#what-are-we-thinking"><i class="fa fa-check"></i><b>8.2</b> What are we thinking?</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="part-3-becoming-a-proud-bayesian.html"><a href="part-3-becoming-a-proud-bayesian.html"><i class="fa fa-check"></i><b>9</b> Part 3: Becoming a proud Bayesian</a><ul>
<li class="chapter" data-level="9.1" data-path="part-3-becoming-a-proud-bayesian.html"><a href="part-3-becoming-a-proud-bayesian.html#university-model"><i class="fa fa-check"></i><b>9.1</b> University Model</a><ul>
<li class="chapter" data-level="9.1.1" data-path="part-3-becoming-a-proud-bayesian.html"><a href="part-3-becoming-a-proud-bayesian.html#get-some-intuition"><i class="fa fa-check"></i><b>9.1.1</b> Get some intuition</a></li>
<li class="chapter" data-level="9.1.2" data-path="part-3-becoming-a-proud-bayesian.html"><a href="part-3-becoming-a-proud-bayesian.html#some-additional-intuition"><i class="fa fa-check"></i><b>9.1.2</b> Some additional intuition</a></li>
<li class="chapter" data-level="9.1.3" data-path="part-3-becoming-a-proud-bayesian.html"><a href="part-3-becoming-a-proud-bayesian.html#building-the-model-5"><i class="fa fa-check"></i><b>9.1.3</b> Building the model</a></li>
<li class="chapter" data-level="9.1.4" data-path="part-3-becoming-a-proud-bayesian.html"><a href="part-3-becoming-a-proud-bayesian.html#model-summary-5"><i class="fa fa-check"></i><b>9.1.4</b> Model summary</a></li>
<li class="chapter" data-level="9.1.5" data-path="part-3-becoming-a-proud-bayesian.html"><a href="part-3-becoming-a-proud-bayesian.html#posterior-inference-5"><i class="fa fa-check"></i><b>9.1.5</b> Posterior inference</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="part-3-becoming-a-proud-bayesian.html"><a href="part-3-becoming-a-proud-bayesian.html#liberal-arts-colleges"><i class="fa fa-check"></i><b>9.2</b> Liberal Arts Colleges</a><ul>
<li class="chapter" data-level="9.2.1" data-path="part-3-becoming-a-proud-bayesian.html"><a href="part-3-becoming-a-proud-bayesian.html#get-some-intuition-1"><i class="fa fa-check"></i><b>9.2.1</b> Get some intuition</a></li>
<li class="chapter" data-level="9.2.2" data-path="part-3-becoming-a-proud-bayesian.html"><a href="part-3-becoming-a-proud-bayesian.html#building-the-model-6"><i class="fa fa-check"></i><b>9.2.2</b> Building the model</a></li>
<li class="chapter" data-level="9.2.3" data-path="part-3-becoming-a-proud-bayesian.html"><a href="part-3-becoming-a-proud-bayesian.html#model-summary-6"><i class="fa fa-check"></i><b>9.2.3</b> Model summary</a></li>
<li class="chapter" data-level="9.2.4" data-path="part-3-becoming-a-proud-bayesian.html"><a href="part-3-becoming-a-proud-bayesian.html#posterior-inference-6"><i class="fa fa-check"></i><b>9.2.4</b> Posterior inference</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="part-3-becoming-a-proud-bayesian.html"><a href="part-3-becoming-a-proud-bayesian.html#comparison-discussion"><i class="fa fa-check"></i><b>9.3</b> Comparison &amp; Discussion</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="a-little-shiny.html"><a href="a-little-shiny.html"><i class="fa fa-check"></i><b>10</b> A Little Shiny</a><ul>
<li class="chapter" data-level="10.1" data-path="a-little-shiny.html"><a href="a-little-shiny.html#user-input"><i class="fa fa-check"></i><b>10.1</b> User Input</a></li>
<li class="chapter" data-level="10.2" data-path="a-little-shiny.html"><a href="a-little-shiny.html#possible-data-cleaning"><i class="fa fa-check"></i><b>10.2</b> Possible Data Cleaning?</a></li>
<li class="chapter" data-level="10.3" data-path="a-little-shiny.html"><a href="a-little-shiny.html#shiny-app"><i class="fa fa-check"></i><b>10.3</b> Shiny App</a></li>
<li class="chapter" data-level="10.4" data-path="a-little-shiny.html"><a href="a-little-shiny.html#in-case-youre-curious"><i class="fa fa-check"></i><b>10.4</b> In case you’re curious…</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="keep-shining.html"><a href="keep-shining.html"><i class="fa fa-check"></i><b>11</b> Keep Shining</a><ul>
<li class="chapter" data-level="11.1" data-path="keep-shining.html"><a href="keep-shining.html#the-good-the-bad-the-shiny"><i class="fa fa-check"></i><b>11.1</b> The Good, The Bad &amp; The Shiny</a></li>
<li class="chapter" data-level="11.2" data-path="keep-shining.html"><a href="keep-shining.html#citations"><i class="fa fa-check"></i><b>11.2</b> Citations</a></li>
<li class="chapter" data-level="11.3" data-path="keep-shining.html"><a href="keep-shining.html#special-thanks-at-zuofus-github"><i class="fa fa-check"></i><b>11.3</b> Special Thanks at Zuofu’s Github</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MATH 454 Bayesian Statistics - College Ranking</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bayesian-models-1.1-universities" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Bayesian Models 1.1 Universities</h1>
<p>How will we simulate what we want to know?</p>
<p><strong>HINT: Start SIMPLE</strong></p>
<div id="model-0" class="section level2">
<h2><span class="header-section-number">6.1</span> Model 0</h2>
<p>Ranking by one year of SAT score: with intuition from <span class="math inline">\(\text{hist}(\sqrt{1/rgamma(10000,a,b)})\)</span>.</p>
<div id="first-impression" class="section level3">
<h3><span class="header-section-number">6.1.1</span> First Impression</h3>
<p><img src="CollegeRanking_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>It appears to be a linear relationship! So, we proceeded to create a normal prior made of a linear combination of values.</p>
</div>
<div id="building-the-model" class="section level3">
<h3><span class="header-section-number">6.1.2</span> Building the model</h3>
<p>Let <span class="math inline">\(Y_i\)</span> denote the predicted ranking of a university in Year 2018. <span class="math inline">\(Y_i\)</span> is
predicted by</p>
<p><span class="math display">\[X_i = \text{student mean SAT score of Year 2016-17}\]</span></p>
<p>Our model can be written as:</p>
<p><span class="math display">\[\begin{align} Y_i &amp; \sim N(\beta_0 + \beta_1X_i,\tau_0) \\
\beta_0 &amp; \sim N(300,250000^{-1}) \\
\beta_1 &amp; \sim N(0,100^{-1}) \\
\tau_0 &amp; \sim Gamma(7,4000) \end{align}\]</span></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="co"># DEFINE the model</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2">university_model_<span class="dv">0</span> &lt;-<span class="st"> &quot;model{</span></a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="st">    for(i in 1:length(y)) {</span></a>
<a class="sourceLine" id="cb28-4" data-line-number="4"><span class="st">        # Data model</span></a>
<a class="sourceLine" id="cb28-5" data-line-number="5"><span class="st">        y[i] ~ dnorm(beta0 + beta1 * x[i], tau0)</span></a>
<a class="sourceLine" id="cb28-6" data-line-number="6"><span class="st">    }</span></a>
<a class="sourceLine" id="cb28-7" data-line-number="7"></a>
<a class="sourceLine" id="cb28-8" data-line-number="8"><span class="st">    # Priors for theta</span></a>
<a class="sourceLine" id="cb28-9" data-line-number="9"><span class="st">    beta0 ~ dnorm(300,1/250000)</span></a>
<a class="sourceLine" id="cb28-10" data-line-number="10"><span class="st">    beta1 ~ dnorm(0, 1/100)</span></a>
<a class="sourceLine" id="cb28-11" data-line-number="11"><span class="st">    tau0 ~ dgamma(7,4000)</span></a>
<a class="sourceLine" id="cb28-12" data-line-number="12"></a>
<a class="sourceLine" id="cb28-13" data-line-number="13"><span class="st">}&quot;</span></a>
<a class="sourceLine" id="cb28-14" data-line-number="14"></a>
<a class="sourceLine" id="cb28-15" data-line-number="15"></a>
<a class="sourceLine" id="cb28-16" data-line-number="16"><span class="co"># COMPILE the model</span></a>
<a class="sourceLine" id="cb28-17" data-line-number="17">model_data0 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">y =</span> fullUniversity<span class="op">$</span>Y2018, <span class="dt">x =</span> fullUniversity<span class="op">$</span>SAT_AVG_<span class="dv">1617</span>)</a>
<a class="sourceLine" id="cb28-18" data-line-number="18">model_data0 &lt;-<span class="st"> </span><span class="kw">na.omit</span>(model_data0)</a>
<a class="sourceLine" id="cb28-19" data-line-number="19"></a>
<a class="sourceLine" id="cb28-20" data-line-number="20">university_jags_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="kw">jags.model</span>(<span class="kw">textConnection</span>(university_model_<span class="dv">0</span>), </a>
<a class="sourceLine" id="cb28-21" data-line-number="21">    <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">y =</span> model_data0<span class="op">$</span>y, <span class="dt">x =</span> model_data0<span class="op">$</span>x),</a>
<a class="sourceLine" id="cb28-22" data-line-number="22">    <span class="dt">inits =</span> <span class="kw">list</span>(<span class="dt">.RNG.name =</span> <span class="st">&quot;base::Wichmann-Hill&quot;</span>, <span class="dt">.RNG.seed =</span> <span class="dv">454</span>))</a></code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 114
##    Unobserved stochastic nodes: 3
##    Total graph size: 440
## 
## Initializing model</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="co"># SIMULATE the model</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2">university_sim_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="kw">coda.samples</span>(university_jags_<span class="dv">0</span>,</a>
<a class="sourceLine" id="cb30-3" data-line-number="3">    <span class="dt">variable.names =</span> <span class="kw">c</span>(<span class="st">&quot;beta0&quot;</span>, <span class="st">&quot;beta1&quot;</span>, <span class="st">&quot;tau0&quot;</span>),</a>
<a class="sourceLine" id="cb30-4" data-line-number="4">    <span class="dt">n.iter =</span> <span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb30-5" data-line-number="5"></a>
<a class="sourceLine" id="cb30-6" data-line-number="6"><span class="co"># STORE the chains in a data frame</span></a>
<a class="sourceLine" id="cb30-7" data-line-number="7">university_chains_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="kw">data.frame</span>(university_sim_<span class="dv">0</span>[[<span class="dv">1</span>]])</a></code></pre></div>
</div>
<div id="model-summary" class="section level3">
<h3><span class="header-section-number">6.1.3</span> Model summary</h3>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw">summary</span>(university_sim_<span class="dv">0</span>)</a></code></pre></div>
<pre><code>## 
## Iterations = 1:10000
## Thinning interval = 1 
## Number of chains = 1 
## Sample size per chain = 10000 
## 
## 1. Empirical mean and standard deviation for each variable,
##    plus standard error of the mean:
## 
##             Mean        SD  Naive SE Time-series SE
## beta0 403.411563 3.227e+01 3.227e-01      4.714e+00
## beta1  -0.263423 2.472e-02 2.472e-04      3.617e-03
## tau0    0.002421 3.279e-04 3.279e-06      1.303e-05
## 
## 2. Quantiles for each variable:
## 
##            2.5%        25%        50%        75%      97.5%
## beta0 355.59133 390.793008 405.743679 421.198553 447.191343
## beta1  -0.29699  -0.277127  -0.265219  -0.253713  -0.226779
## tau0    0.00182   0.002212   0.002415   0.002628   0.003062</code></pre>
</div>
<div id="posterior-inference" class="section level3">
<h3><span class="header-section-number">6.1.4</span> Posterior inference</h3>
<p>For an unknown university with a mean student SAT score of 1450 (e.g. Bvictor University), we could predict its ranking from our rjags simulation.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">university_chains_<span class="dv">0</span> &lt;-<span class="st"> </span>university_chains_<span class="dv">0</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ranking_new =</span> <span class="kw">rnorm</span>(<span class="dv">10000</span>, <span class="dt">mean =</span> beta0 <span class="op">+</span><span class="st"> </span>beta1<span class="op">*</span><span class="dv">1450</span>, <span class="dt">sd =</span> (<span class="dv">1</span><span class="op">/</span>tau0)<span class="op">^</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)))</a></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">university_chains_<span class="dv">0</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb34-2" data-line-number="2"><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">quantile</span>(ranking_new,<span class="fl">0.025</span>),<span class="kw">quantile</span>(ranking_new,<span class="fl">0.975</span>))</a></code></pre></div>
<pre><code>##   quantile(ranking_new, 0.025) quantile(ranking_new, 0.975)
## 1                    -19.40776                     62.78438</code></pre>
<p>A <span class="math inline">\(95\%\)</span> credible interval is <span class="math inline">\((-20,62)\)</span>.Unfortunately, we ended up with range that included negative values, which led us to believe that we either needed more predictors, or we needed to change the model type. Due to restrictions of this one-predictor model, we expect to see an improvement in later models. We decided to try adding more predictors first.</p>
</div>
</div>
<div id="model-1" class="section level2">
<h2><span class="header-section-number">6.2</span> Model 1</h2>
<div id="first-impression-1" class="section level3">
<h3><span class="header-section-number">6.2.1</span> First Impression</h3>
<p>It’s harder to make predictions (and as it turns out, hard to make visualizations as well) with three years’ SAT score in the same linear model, as we can foresee significant multicollinearity. This is clearly seen that the coefficient for SAT average of Year 2014-15 (SAT_AVG_1415) variable is positive, meaning that school ranking worsens as the average SAT score increases.</p>
<p>To further test our thinking, we created a linear model <em>university_linear_1</em>. From the ANOVA summary, we see that any one of these variables should be sufficient.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">university_linear_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">as.numeric</span>(Y2018) <span class="op">~</span><span class="st"> </span>SAT_AVG_<span class="dv">1617</span> <span class="op">+</span><span class="st"> </span>SAT_AVG_<span class="dv">1516</span> <span class="op">+</span><span class="st"> </span>SAT_AVG_<span class="dv">1415</span>, fullUniversity)</a>
<a class="sourceLine" id="cb36-2" data-line-number="2"></a>
<a class="sourceLine" id="cb36-3" data-line-number="3"><span class="kw">summary</span>(university_linear_<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = as.numeric(Y2018) ~ SAT_AVG_1617 + SAT_AVG_1516 + 
##     SAT_AVG_1415, data = fullUniversity)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -104.127   -8.988   -2.062   12.129   38.789 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  415.49873   20.70087  20.072   &lt;2e-16 ***
## SAT_AVG_1617  -0.04769    0.14485  -0.329    0.743    
## SAT_AVG_1516  -0.26890    0.18977  -1.417    0.159    
## SAT_AVG_1415   0.04301    0.16163   0.266    0.791    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 19.68 on 110 degrees of freedom
##   (6 observations deleted due to missingness)
## Multiple R-squared:  0.7292, Adjusted R-squared:  0.7218 
## F-statistic: 98.75 on 3 and 110 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1"><span class="kw">anova</span>(university_linear_<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: as.numeric(Y2018)
##               Df Sum Sq Mean Sq  F value Pr(&gt;F)    
## SAT_AVG_1617   1 113627  113627 293.4484 &lt;2e-16 ***
## SAT_AVG_1516   1   1052    1052   2.7173 0.1021    
## SAT_AVG_1415   1     27      27   0.0708 0.7907    
## Residuals    110  42594     387                    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>We decided to model ranking by using the three years of average SAT scores. Through summary analysis and an analysis of variance (ANOVA), the three predictors are multicollinear, meaning that this may not be a significantly better model than Model 0.</p>
<p><strong>For the sake of scientific experiment (and to catch the audience’s interest)</strong>, we still did a Bayesian model and Bayesian posterior inference. We found out that this model does a slightly better job at predicting college rankings (by eliminating negative rankings) because it naturally contains more information as we increase the number of predictors. The change is <strong>not</strong> significant enough to call it an improvement.</p>
</div>
<div id="building-the-model-1" class="section level3">
<h3><span class="header-section-number">6.2.2</span> Building the model</h3>
<p>Similarly, we construct a linear regression model of</p>
<p><span class="math display">\[Y_i = \text{the predicted 2018 ranking of a university}\]</span>
by</p>
<p><span class="math display">\[\begin{align} X_{1i} &amp; = \text{student mean SAT score of Year 2014-15} \\
X_{2i} &amp; = \text{student mean SAT score of Year 2015-16} \\
X_{3i} &amp; = \text{student mean SAT score of Year 2016-17} \end{align}\]</span></p>
<p>where</p>
<p><span class="math display">\[\begin{align} Y_i &amp; \sim N(\beta_0 + \beta_1X_{1i} + \beta_2X_{2i} +
\beta_3X_{3i},\tau_{\text{big}}) \\
\beta_0 &amp; \sim N(0,250000^{-1}) \\
\beta_1 &amp; \sim N(0,0.01^{-1}) \\
\beta_2 &amp; \sim N(0,0.01^{-1}) \\
\beta_3 &amp; \sim N(0,0.01^{-1}) \\
\tau_{\text{big}} &amp; \sim Gamma(7,1000) \end{align}\]</span></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">university_model_<span class="dv">1</span> &lt;-<span class="st"> &quot;model{  </span></a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="st">    # Data: observations</span></a>
<a class="sourceLine" id="cb40-3" data-line-number="3"><span class="st">    for(i in 1:length(y)) {</span></a>
<a class="sourceLine" id="cb40-4" data-line-number="4"><span class="st">        y[i] ~ dnorm(beta0 + beta1*x1[i] + beta2*x2[i] + beta3*x3[i], tau_big)</span></a>
<a class="sourceLine" id="cb40-5" data-line-number="5"><span class="st">    }</span></a>
<a class="sourceLine" id="cb40-6" data-line-number="6"></a>
<a class="sourceLine" id="cb40-7" data-line-number="7"><span class="st">        # Data: subjects</span></a>
<a class="sourceLine" id="cb40-8" data-line-number="8"><span class="st">        beta0 ~ dnorm(0,1/250000)</span></a>
<a class="sourceLine" id="cb40-9" data-line-number="9"><span class="st">        beta1 ~ dnorm(0,100)</span></a>
<a class="sourceLine" id="cb40-10" data-line-number="10"><span class="st">        beta2 ~ dnorm(0,100)</span></a>
<a class="sourceLine" id="cb40-11" data-line-number="11"><span class="st">        beta3 ~ dnorm(0,100)</span></a>
<a class="sourceLine" id="cb40-12" data-line-number="12"><span class="st">        tau_big ~ dgamma(7,1000)</span></a>
<a class="sourceLine" id="cb40-13" data-line-number="13"></a>
<a class="sourceLine" id="cb40-14" data-line-number="14"><span class="st">}&quot;</span></a>
<a class="sourceLine" id="cb40-15" data-line-number="15"></a>
<a class="sourceLine" id="cb40-16" data-line-number="16"><span class="co"># COMPILE</span></a>
<a class="sourceLine" id="cb40-17" data-line-number="17"></a>
<a class="sourceLine" id="cb40-18" data-line-number="18">y &lt;-<span class="st"> </span>fullUniversity<span class="op">$</span>Y2018</a>
<a class="sourceLine" id="cb40-19" data-line-number="19"></a>
<a class="sourceLine" id="cb40-20" data-line-number="20">model_data1 &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">cbind</span>(y, <span class="dt">x1 =</span> fullUniversity<span class="op">$</span>SAT_AVG_<span class="dv">1415</span>, <span class="dt">x2 =</span> fullUniversity<span class="op">$</span>SAT_AVG_<span class="dv">1516</span>, <span class="dt">x3 =</span> fullUniversity<span class="op">$</span>SAT_AVG_<span class="dv">1617</span>))</a>
<a class="sourceLine" id="cb40-21" data-line-number="21">model_data1 &lt;-<span class="st"> </span><span class="kw">na.omit</span>(model_data1)</a>
<a class="sourceLine" id="cb40-22" data-line-number="22"></a>
<a class="sourceLine" id="cb40-23" data-line-number="23">university_jags_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">jags.model</span>(<span class="kw">textConnection</span>(university_model_<span class="dv">1</span>), </a>
<a class="sourceLine" id="cb40-24" data-line-number="24">    <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">y =</span> model_data1<span class="op">$</span>y, <span class="dt">x1 =</span> model_data1<span class="op">$</span>x1, <span class="dt">x2 =</span> model_data1<span class="op">$</span>x2, <span class="dt">x3 =</span> model_data1<span class="op">$</span>x3),</a>
<a class="sourceLine" id="cb40-25" data-line-number="25">    <span class="dt">inits=</span><span class="kw">list</span>(<span class="dt">.RNG.name =</span> <span class="st">&quot;base::Wichmann-Hill&quot;</span>, <span class="dt">.RNG.seed =</span> <span class="dv">454</span>))</a></code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 114
##    Unobserved stochastic nodes: 5
##    Total graph size: 876
## 
## Initializing model</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="co"># SIMULATE the model</span></a>
<a class="sourceLine" id="cb42-2" data-line-number="2">university_sim_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">coda.samples</span>(university_jags_<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb42-3" data-line-number="3">    <span class="dt">variable.names =</span> <span class="kw">c</span>(<span class="st">&quot;beta0&quot;</span>,<span class="st">&quot;beta1&quot;</span>,<span class="st">&quot;beta2&quot;</span>,<span class="st">&quot;beta3&quot;</span>,<span class="st">&quot;tau_big&quot;</span>),</a>
<a class="sourceLine" id="cb42-4" data-line-number="4">    <span class="dt">n.iter =</span> <span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb42-5" data-line-number="5"></a>
<a class="sourceLine" id="cb42-6" data-line-number="6"><span class="co"># STORE the chains in a data frame</span></a>
<a class="sourceLine" id="cb42-7" data-line-number="7">university_chains_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">data.frame</span>(university_sim_<span class="dv">1</span>[[<span class="dv">1</span>]])</a></code></pre></div>
</div>
<div id="model-summary-1" class="section level3">
<h3><span class="header-section-number">6.2.3</span> Model summary</h3>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="kw">summary</span>(university_sim_<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## 
## Iterations = 1:10000
## Thinning interval = 1 
## Number of chains = 1 
## Sample size per chain = 10000 
## 
## 1. Empirical mean and standard deviation for each variable,
##    plus standard error of the mean:
## 
##               Mean        SD  Naive SE Time-series SE
## beta0   409.864989 3.553e+01 3.553e-01      5.783e+00
## beta1     0.001373 1.078e-01 1.078e-03      1.120e-01
## beta2    -0.179656 7.938e-02 7.938e-04      4.684e-02
## beta3    -0.090932 7.417e-02 7.417e-04      5.086e-02
## tau_big   0.002781 4.008e-04 4.008e-06      2.714e-05
## 
## 2. Quantiles for each variable:
## 
##               2.5%        25%        50%        75%      97.5%
## beta0   345.977738 400.686962 414.807439 427.055384 447.427911
## beta1    -0.224077  -0.074142   0.033869   0.084271   0.127709
## beta2    -0.304552  -0.247353  -0.181364  -0.127231  -0.006660
## beta3    -0.212426  -0.151206  -0.106569  -0.025275   0.034454
## tau_big   0.002051   0.002538   0.002778   0.003029   0.003556</code></pre>
</div>
<div id="posterior-inference-1" class="section level3">
<h3><span class="header-section-number">6.2.4</span> Posterior inference</h3>
<p>For an unknown university with three years’ mean student SAT score of 1450, 1440, 1420 (e.g. Cvictor University), we could predict its ranking from our rjags simulation.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1">university_chains_<span class="dv">1</span> &lt;-<span class="st"> </span>university_chains_<span class="dv">1</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb45-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ranking_new =</span> <span class="kw">rnorm</span>(<span class="dv">10000</span>, <span class="dt">mean =</span> beta0 <span class="op">+</span><span class="st"> </span>beta1<span class="op">*</span><span class="dv">1450</span> <span class="op">+</span><span class="st"> </span>beta2<span class="op">*</span><span class="dv">1440</span> <span class="op">+</span>beta3<span class="op">*</span><span class="dv">1420</span>, <span class="dt">sd =</span> (<span class="dv">1</span><span class="op">/</span>tau_big)<span class="op">^</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)))</a></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1">university_chains_<span class="dv">1</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb46-2" data-line-number="2"><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">quantile</span>(ranking_new,<span class="fl">0.025</span>),<span class="kw">quantile</span>(ranking_new,<span class="fl">0.975</span>))</a></code></pre></div>
<pre><code>##   quantile(ranking_new, 0.025) quantile(ranking_new, 0.975)
## 1                    -14.52939                     63.60583</code></pre>
<p>A <span class="math inline">\(95\%\)</span> credible interval is <span class="math inline">\((-14,64)\)</span>. The <span class="math inline">\(95\%\)</span> credible interval in the new model does a better job at eliminating negative rankings, which are impossible in reality.</p>
</div>
</div>
<div id="model-2" class="section level2">
<h2><span class="header-section-number">6.3</span> Model 2</h2>
<p>2018 U.S. News Ranking by average SAT score and admissions rate of Year 2017.</p>
<div id="first-impression-2" class="section level3">
<h3><span class="header-section-number">6.3.1</span> First Impression</h3>
<p><img src="CollegeRanking_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<p>There’s a strong positive relationship between the admission rate of colleges and college ranking (a larger number in college ranking is <em>worse</em>). From color gradient of points, we can see that schools with higher SAT averages tend to be better ranked.</p>
</div>
<div id="building-the-model-2" class="section level3">
<h3><span class="header-section-number">6.3.2</span> Building the model</h3>
<div id="step-1" class="section level4">
<h4><span class="header-section-number">6.3.2.1</span> Step 1</h4>
<p>A linear model provides some intuition about how the priors might be constructed.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1"><span class="kw">summary</span>(<span class="kw">lm</span>(fullUniversity<span class="op">$</span>Y2018 <span class="op">~</span><span class="st"> </span>fullUniversity<span class="op">$</span>SAT_AVG_<span class="dv">1617</span> <span class="op">+</span><span class="st"> </span>fullUniversity<span class="op">$</span>ADM_RATE_<span class="dv">1617</span>))</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = fullUniversity$Y2018 ~ fullUniversity$SAT_AVG_1617 + 
##     fullUniversity$ADM_RATE_1617)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -78.978  -9.142  -1.986   8.865  43.380 
## 
## Coefficients:
##                              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                  172.5262    45.1297   3.823 0.000218 ***
## fullUniversity$SAT_AVG_1617   -0.1150     0.0301  -3.822 0.000219 ***
## fullUniversity$ADM_RATE_1617  84.8854    14.8094   5.732 8.66e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 17.42 on 111 degrees of freedom
##   (6 observations deleted due to missingness)
## Multiple R-squared:  0.7858, Adjusted R-squared:  0.7819 
## F-statistic: 203.6 on 2 and 111 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div id="step-2" class="section level4">
<h4><span class="header-section-number">6.3.2.2</span> Step 2</h4>
<p>Next, we construct a <strong>hierarchical</strong> model (because we just learned this and
wanted to show off) of</p>
<p><span class="math display">\[Y_i = \text{the predicted 2018 ranking of a university}\]</span>
by</p>
<p><span class="math display">\[\begin{align} X_{1i} &amp; = \text{student mean SAT score of Year 2016-17} \\
X_{2i} &amp; = \text{admissions rate during Year 2016-17} \end{align}\]</span></p>
<p>where</p>
<p><span class="math display">\[\begin{align} Y_i &amp; \sim N(\beta_{0i} + \beta_{1i}X_{1i} + \beta_{2i}X_{2i},
\tau_{\text{big},i}) \\
\beta_{0i} &amp; \sim N(b_0,\tau_0) \\
\beta_{1i} &amp; \sim N(b_1,\tau_1) \\
\beta_{2i} &amp; \sim N(b_2,\tau_2) \\
\tau_{\text{big},i} &amp; \sim Gamma(s,r) \\
b_0 &amp; \sim N(180,4000^{-1}) \\
\tau_0 &amp; \sim N(30, 1/9) \\
b_1 &amp; \sim N(-0.1,0.001^{-1}) \\
\tau_1 &amp; \sim N(1000, 0.001^{-1}) \\
b_2 &amp; \sim N(80,100^{-1}) \\
\tau_2 &amp; \sim N(10, 1) \\
s &amp; \sim N(7,1) \\
r &amp; \sim N(10000, 10000^{-1}) \end{align}\]</span></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1">university_model_<span class="dv">2</span> &lt;-<span class="st"> &quot;model{  </span></a>
<a class="sourceLine" id="cb50-2" data-line-number="2"><span class="st">    # Data: observations</span></a>
<a class="sourceLine" id="cb50-3" data-line-number="3"><span class="st">    for(i in 1:length(y)) {</span></a>
<a class="sourceLine" id="cb50-4" data-line-number="4"><span class="st">        y[i] ~ dnorm(beta0[i] + beta1[i]*x1[i] + beta2[i]*x2[i], tau_big[i])</span></a>
<a class="sourceLine" id="cb50-5" data-line-number="5"></a>
<a class="sourceLine" id="cb50-6" data-line-number="6"><span class="st">        # Data: subjects</span></a>
<a class="sourceLine" id="cb50-7" data-line-number="7"><span class="st">        beta0[i] ~ dnorm(b0, tau0)</span></a>
<a class="sourceLine" id="cb50-8" data-line-number="8"><span class="st">        beta1[i] ~ dnorm(b1,tau1)</span></a>
<a class="sourceLine" id="cb50-9" data-line-number="9"><span class="st">        beta2[i] ~ dnorm(b2,tau2)</span></a>
<a class="sourceLine" id="cb50-10" data-line-number="10"><span class="st">        tau_big[i] ~ dgamma(s,r)</span></a>
<a class="sourceLine" id="cb50-11" data-line-number="11"><span class="st">    }</span></a>
<a class="sourceLine" id="cb50-12" data-line-number="12"></a>
<a class="sourceLine" id="cb50-13" data-line-number="13"><span class="st">    # Hyperpriors</span></a>
<a class="sourceLine" id="cb50-14" data-line-number="14"><span class="st">    b0 ~ dnorm(180,1/4000)</span></a>
<a class="sourceLine" id="cb50-15" data-line-number="15"><span class="st">    tau0 ~ dnorm(30, 1/9)</span></a>
<a class="sourceLine" id="cb50-16" data-line-number="16"><span class="st">    b1 ~ dnorm(-0.1,1000)</span></a>
<a class="sourceLine" id="cb50-17" data-line-number="17"><span class="st">    tau1 ~ dnorm(1000,1000) </span></a>
<a class="sourceLine" id="cb50-18" data-line-number="18"><span class="st">    b2 ~ dnorm(80,1/100)</span></a>
<a class="sourceLine" id="cb50-19" data-line-number="19"><span class="st">    tau2 ~ dnorm(10,1)</span></a>
<a class="sourceLine" id="cb50-20" data-line-number="20"><span class="st">    s ~ dnorm(7,1)</span></a>
<a class="sourceLine" id="cb50-21" data-line-number="21"><span class="st">    r ~ dnorm(10000, 1/10000)</span></a>
<a class="sourceLine" id="cb50-22" data-line-number="22"><span class="st">}&quot;</span></a>
<a class="sourceLine" id="cb50-23" data-line-number="23"></a>
<a class="sourceLine" id="cb50-24" data-line-number="24"><span class="co"># COMPILE</span></a>
<a class="sourceLine" id="cb50-25" data-line-number="25"></a>
<a class="sourceLine" id="cb50-26" data-line-number="26">y &lt;-<span class="st"> </span>fullUniversity<span class="op">$</span>Y2018</a>
<a class="sourceLine" id="cb50-27" data-line-number="27"></a>
<a class="sourceLine" id="cb50-28" data-line-number="28">model_data2 &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">cbind</span>(y, <span class="dt">x1 =</span> fullUniversity<span class="op">$</span>SAT_AVG_<span class="dv">1617</span>, <span class="dt">x2 =</span> fullUniversity<span class="op">$</span>ADM_RATE_<span class="dv">1617</span>))</a>
<a class="sourceLine" id="cb50-29" data-line-number="29">model_data2 &lt;-<span class="st"> </span><span class="kw">na.omit</span>(model_data2)</a>
<a class="sourceLine" id="cb50-30" data-line-number="30"></a>
<a class="sourceLine" id="cb50-31" data-line-number="31">university_jags_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">jags.model</span>(<span class="kw">textConnection</span>(university_model_<span class="dv">2</span>), </a>
<a class="sourceLine" id="cb50-32" data-line-number="32">    <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">y =</span> model_data2<span class="op">$</span>y, <span class="dt">x1 =</span> model_data2<span class="op">$</span>x1, <span class="dt">x2 =</span> model_data2<span class="op">$</span>x2),</a>
<a class="sourceLine" id="cb50-33" data-line-number="33">    <span class="dt">inits=</span><span class="kw">list</span>(<span class="dt">.RNG.name =</span> <span class="st">&quot;base::Wichmann-Hill&quot;</span>, <span class="dt">.RNG.seed =</span> <span class="dv">454</span>))</a></code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 114
##    Unobserved stochastic nodes: 464
##    Total graph size: 1165
## 
## Initializing model</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1"><span class="co"># SIMULATE the model</span></a>
<a class="sourceLine" id="cb52-2" data-line-number="2">university_sim_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">coda.samples</span>(university_jags_<span class="dv">2</span>,</a>
<a class="sourceLine" id="cb52-3" data-line-number="3">    <span class="dt">variable.names =</span> <span class="kw">c</span>(<span class="st">&quot;b0&quot;</span>,<span class="st">&quot;tau0&quot;</span>,<span class="st">&quot;b1&quot;</span>,<span class="st">&quot;tau1&quot;</span>,<span class="st">&quot;b2&quot;</span>,<span class="st">&quot;tau2&quot;</span>,<span class="st">&quot;s&quot;</span>,<span class="st">&quot;r&quot;</span>),</a>
<a class="sourceLine" id="cb52-4" data-line-number="4">    <span class="dt">n.iter =</span> <span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb52-5" data-line-number="5"></a>
<a class="sourceLine" id="cb52-6" data-line-number="6"><span class="co"># STORE the chains in a data frame</span></a>
<a class="sourceLine" id="cb52-7" data-line-number="7">university_chains_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">data.frame</span>(university_sim_<span class="dv">2</span>[[<span class="dv">1</span>]])</a></code></pre></div>
</div>
</div>
<div id="model-summary-2" class="section level3">
<h3><span class="header-section-number">6.3.3</span> Model summary</h3>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1"><span class="kw">summary</span>(university_sim_<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## 
## Iterations = 1001:11000
## Thinning interval = 1 
## Number of chains = 1 
## Sample size per chain = 10000 
## 
## 1. Empirical mean and standard deviation for each variable,
##    plus standard error of the mean:
## 
##          Mean        SD  Naive SE Time-series SE
## b0    181.003  0.866642 8.666e-03      0.4845152
## b1     -0.122  0.003986 3.986e-05      0.0001962
## b2     86.978  2.748797 2.749e-02      2.0167560
## r    9978.437 98.495695 9.850e-01      1.3555384
## s       9.367  0.854744 8.547e-03      0.0428560
## tau0   29.903  3.051727 3.052e-02      0.0544687
## tau1 1000.000  0.031393 3.139e-04      0.0003934
## tau2   10.021  1.000127 1.000e-02      0.0179231
## 
## 2. Quantiles for each variable:
## 
##           2.5%       25%      50%        75%      97.5%
## b0    179.2258  180.2942  181.163   181.6543   182.5227
## b1     -0.1298   -0.1247   -0.122    -0.1193    -0.1143
## b2     80.6675   85.0648   87.714    89.2203    90.5414
## r    9784.6197 9912.1376 9978.523 10044.9089 10170.4126
## s       7.7114    8.7880    9.345     9.9331    11.0906
## tau0   23.8816   27.8340   29.879    31.9392    35.9038
## tau1  999.9366  999.9792 1000.000  1000.0208  1000.0615
## tau2    8.0599    9.3477   10.030    10.6819    12.0006</code></pre>
</div>
<div id="posterior-inference-2" class="section level3">
<h3><span class="header-section-number">6.3.4</span> Posterior inference</h3>
<p>For an unknown university with student mean SAT score of 1450 and an admission rate of <span class="math inline">\(30\%\)</span> (e.g. Dvictor University), we could predict its ranking from our rjags simulation.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1">university_chains_<span class="dv">2</span> &lt;-<span class="st"> </span>university_chains_<span class="dv">2</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb55-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">beta0_new =</span> <span class="kw">rnorm</span>(<span class="dv">10000</span>,b0,(<span class="dv">1</span><span class="op">/</span>tau0)<span class="op">^</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb55-3" data-line-number="3"><span class="st">           </span><span class="kw">mutate</span>(<span class="dt">beta1_new =</span> <span class="kw">rnorm</span>(<span class="dv">10000</span>,b1,(<span class="dv">1</span><span class="op">/</span>tau1)<span class="op">^</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb55-4" data-line-number="4"><span class="st">           </span><span class="kw">mutate</span>(<span class="dt">beta2_new =</span> <span class="kw">rnorm</span>(<span class="dv">10000</span>,b2,(<span class="dv">1</span><span class="op">/</span>tau2)<span class="op">^</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb55-5" data-line-number="5"><span class="st">           </span><span class="kw">mutate</span>(<span class="dt">tau_big_new =</span> <span class="kw">rgamma</span>(<span class="dv">10000</span>,s,r)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb55-6" data-line-number="6"><span class="st">           </span><span class="kw">mutate</span>(<span class="dt">ranking_new =</span> <span class="kw">rnorm</span>(<span class="dv">10000</span>, <span class="dt">mean =</span> beta0_new <span class="op">+</span><span class="st"> </span>beta1_new <span class="op">*</span><span class="st"> </span><span class="dv">1450</span> <span class="op">+</span><span class="st"> </span>beta2_new <span class="op">*</span><span class="st"> </span><span class="fl">0.3</span>, <span class="dt">sd =</span> (<span class="dv">1</span><span class="op">/</span>tau_big_new)<span class="op">^</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)))</a></code></pre></div>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1">university_chains_<span class="dv">2</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb56-2" data-line-number="2"><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">quantile</span>(ranking_new,<span class="fl">0.025</span>),<span class="kw">quantile</span>(ranking_new,<span class="fl">0.975</span>))</a></code></pre></div>
<pre><code>##   quantile(ranking_new, 0.025) quantile(ranking_new, 0.975)
## 1                    -81.84403                     142.8057</code></pre>
<p>A <span class="math inline">\(95\%\)</span> credible interval is <span class="math inline">\((-86,142)\)</span>. The <span class="math inline">\(95\%\)</span> credible interval does a poor job at eliminating negative rankings or making an accurate prediction. We propose that this may be due to the variability of the priors and hyperpriors set in our Hierarchical Model.</p>
</div>
</div>
<div id="future-steps" class="section level2">
<h2><span class="header-section-number">6.4</span> Future steps</h2>
<p>Next, we plan to incorporate more predictive variables of ranking <span class="math inline">\(y_i\)</span>. Since some predictors we choose are correlated, we will also emphasize on reflecting that in our models.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="visualizations.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bayesian-models-1-2-lacs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
